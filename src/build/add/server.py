"""A collection of Fibonacci sequence calculation tools
Generated by mcpgen. Server: fibonacci-calculator
"""
from __future__ import annotations
from typing import Any, List, Dict, Optional
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("fibonacci-calculator", log_level="ERROR")



@mcp.tool()
def calculate_fibonacci(n: int = None) -> int:
    """Calculate the nth Fibonacci number (0-indexed)"""
    if n < 0:
        raise ValueError("Index must be non-negative")
    if n == 0:
        return 0
    if n == 1:
        return 1
    a, b = 0, 1
    for _ in range(2, n + 1):
        a, b = b, a + b
    return b

@mcp.tool()
def fibonacci_sequence(count: int = None) -> List[int]:
    """Generate a list of Fibonacci numbers up to the nth term"""
    if count <= 0:
        return []
    if count == 1:
        return [0]
    sequence = [0, 1]
    for _ in range(2, count):
        sequence.append(sequence[-1] + sequence[-2])
    return sequence

@mcp.tool()
def is_fibonacci_number(num: int = None) -> bool:
    """Check if a given number is in the Fibonacci sequence"""
    import math
    if num < 0:
        return False
    def is_perfect_square(n):
        root = int(math.sqrt(n))
        return root * root == n
    return is_perfect_square(5 * num * num + 4) or is_perfect_square(5 * num * num - 4)

@mcp.tool()
def fibonacci_sum(n: int = None) -> int:
    """Calculate the sum of the first n Fibonacci numbers"""
    if n <= 0:
        return 0
    total = 0
    a, b = 0, 1
    total = a
    if n == 1:
        return total
    total += b
    for _ in range(2, n):
        a, b = b, a + b
        total += b
    return total


class GeneratedToolset:
    """Expose generated MCP tools as bound methods that can be iterated over."""
    _tool_names = ('calculate_fibonacci', 'fibonacci_sequence', 'is_fibonacci_number', 'fibonacci_sum')

    def __iter__(self):
        for tool_name in self._tool_names:
            yield getattr(self, tool_name)

    def calculate_fibonacci(self, n: int = None) -> int:
        return calculate_fibonacci(n)

    def fibonacci_sequence(self, count: int = None) -> List[int]:
        return fibonacci_sequence(count)

    def is_fibonacci_number(self, num: int = None) -> bool:
        return is_fibonacci_number(num)

    def fibonacci_sum(self, n: int = None) -> int:
        return fibonacci_sum(n)


if __name__ == "__main__":
    # stdio transport for agent runtimes
    mcp.run()